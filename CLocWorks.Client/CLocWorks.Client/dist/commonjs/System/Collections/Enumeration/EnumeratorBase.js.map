{"version":3,"sources":["System/Collections/Enumeration/EnumeratorBase.js","System/Collections/Enumeration/EnumeratorBase.ts"],"names":[],"mappings":"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","file":"System/Collections/Enumeration/EnumeratorBase.js","sourcesContent":["/*!\n * @author electricessence / https://github.com/electricessence/\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\n */\n\"use strict\";\nconst Types_1 = require(\"../../Types\");\nconst DisposableBase_1 = require(\"../../Disposable/DisposableBase\");\nconst ObjectPool_1 = require(\"../../Disposable/ObjectPool\");\nconst IteratorResult_1 = require(\"./IteratorResult\");\nconst VOID0 = void (0);\nvar yielderPool;\nfunction yielder(recycle) {\n    if (!yielderPool)\n        yielderPool\n            = new ObjectPool_1.ObjectPool(40, () => new Yielder(), y => y.yieldBreak());\n    if (!recycle)\n        return yielderPool.take();\n    yielderPool.add(recycle);\n}\nclass Yielder {\n    constructor() {\n        this._current = VOID0;\n    }\n    get current() { return this._current; }\n    get index() { return this._index; }\n    yieldReturn(value) {\n        this._current = value;\n        if (this._index === VOID0)\n            this._index = 0;\n        else\n            this._index++;\n        return true;\n    }\n    yieldBreak() {\n        this._current = VOID0;\n        this._index = VOID0;\n        return false;\n    }\n    dispose() {\n        this.yieldBreak();\n    }\n}\nvar EnumeratorState;\n(function (EnumeratorState) {\n    EnumeratorState[EnumeratorState[\"Before\"] = 0] = \"Before\";\n    EnumeratorState[EnumeratorState[\"Running\"] = 1] = \"Running\";\n    EnumeratorState[EnumeratorState[\"After\"] = 2] = \"After\";\n})(EnumeratorState || (EnumeratorState = {}));\nclass EnumeratorBase extends DisposableBase_1.DisposableBase {\n    constructor(_initializer, _tryGetNext, disposer, isEndless) {\n        super();\n        this._initializer = _initializer;\n        this._tryGetNext = _tryGetNext;\n        this.reset();\n        if (Types_1.Type.isBoolean(isEndless))\n            this._isEndless = isEndless;\n        else if (Types_1.Type.isBoolean(disposer))\n            this._isEndless = disposer;\n        if (Types_1.Type.isFunction(disposer))\n            this._disposer = disposer;\n    }\n    get current() {\n        var y = this._yielder;\n        return y && y.current;\n    }\n    get index() {\n        var y = this._yielder;\n        return y && y.index;\n    }\n    get isEndless() {\n        return this._isEndless;\n    }\n    reset() {\n        var _ = this;\n        _.throwIfDisposed();\n        var y = _._yielder;\n        _._yielder = null;\n        _._state = EnumeratorState.Before;\n        if (y)\n            yielder(y);\n    }\n    moveNext() {\n        var _ = this;\n        try {\n            switch (_._state) {\n                case EnumeratorState.Before:\n                    _._yielder = _._yielder || yielder();\n                    _._state = EnumeratorState.Running;\n                    var initializer = _._initializer;\n                    if (initializer)\n                        initializer();\n                case EnumeratorState.Running:\n                    if (_._tryGetNext(_._yielder)) {\n                        return true;\n                    }\n                    else {\n                        this.dispose();\n                        return false;\n                    }\n                case EnumeratorState.After:\n                    return false;\n            }\n        }\n        catch (e) {\n            this.dispose();\n            throw e;\n        }\n    }\n    nextValue() {\n        return this.moveNext()\n            ? this.current\n            : VOID0;\n    }\n    next() {\n        return this.moveNext()\n            ? new IteratorResult_1.IteratorResult(this.current, this.index)\n            : IteratorResult_1.IteratorResult.Done;\n    }\n    'return'(value) {\n        try {\n            return value === VOID0 || this._state === EnumeratorState.After\n                ? IteratorResult_1.IteratorResult.Done\n                : new IteratorResult_1.IteratorResult(value, VOID0, true);\n        }\n        finally {\n            this.dispose();\n        }\n    }\n    _onDispose() {\n        var _ = this, disposer = _._disposer;\n        _._initializer = null;\n        _._disposer = null;\n        var y = _._yielder;\n        _._yielder = null;\n        this._state = EnumeratorState.After;\n        if (y)\n            yielder(y);\n        if (disposer)\n            disposer();\n    }\n}\nexports.EnumeratorBase = EnumeratorBase;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = EnumeratorBase;\n","/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\nimport {Type} from \"../../Types\";\r\nimport {DisposableBase} from \"../../Disposable/DisposableBase\";\r\nimport {ObjectPool} from \"../../Disposable/ObjectPool\";\r\nimport {IDisposable} from \"../../Disposable/IDisposable\";\r\nimport {IEnumerator} from \"./IEnumerator\";\r\nimport {IIteratorResult} from \"./IIterator\";\r\nimport {IYield} from \"./IYield\";\r\nimport {IteratorResult} from \"./IteratorResult\";\r\n\r\nconst VOID0:any = void(0);\r\n\r\nvar yielderPool:ObjectPool<Yielder<any>>;\r\nfunction yielder():Yielder<any>;\r\nfunction yielder(recycle?:Yielder<any>):void;\r\nfunction yielder(recycle?:Yielder<any>):Yielder<any>\r\n{\r\n\tif(!yielderPool)\r\n\t\tyielderPool\r\n\t\t\t= new ObjectPool<Yielder<any>>(40, ()=>new Yielder<any>(),y=>y.yieldBreak());\r\n\tif(!recycle) return yielderPool.take();\r\n\tyielderPool.add(recycle);\r\n}\r\n\r\nclass Yielder<T> implements IYield<T>, IDisposable\r\n{\r\n\tprivate _current:T = VOID0;\r\n\tprivate _index:number;\r\n\r\n\tget current():T { return this._current; } // this class is not entirely local/private.  Still needs protection.\r\n\r\n\tget index():number { return this._index; }\r\n\r\n\tyieldReturn(value:T):boolean\r\n\t{\r\n\t\tthis._current = value;\r\n\t\tif(this._index===VOID0)\r\n\t\t\tthis._index = 0;\r\n\t\telse\r\n\t\t\tthis._index++;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tyieldBreak():boolean\r\n\t{\r\n\t\tthis._current = VOID0;\r\n\t\tthis._index = VOID0;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tdispose():void\r\n\t{\r\n\t\tthis.yieldBreak();\r\n\t}\r\n}\r\n\r\ntype ActionVoid = ()=>void;\r\n\r\n// IEnumerator State\r\nenum EnumeratorState { Before, Running, After }\r\n\r\n// \"Enumerator\" is conflict JScript's \"Enumerator\"\r\n// Naming this class EnumeratorBase to avoid collision with IE.\r\nexport class EnumeratorBase<T> extends DisposableBase implements IEnumerator<T>\r\n{\r\n\r\n\tprivate _yielder:Yielder<T>;\r\n\tprivate _state:EnumeratorState;\r\n\tprivate _disposer:()=>void;\r\n\r\n\tget current():T\r\n\t{\r\n\t\tvar y = this._yielder;\r\n\t\treturn y && y.current;\r\n\t}\r\n\r\n\tget index():number\r\n\t{\r\n\t\tvar y = this._yielder;\r\n\t\treturn y && y.index;\r\n\t}\r\n\r\n\tconstructor(\r\n\t\tinitializer:() => void,\r\n\t\ttryGetNext:(yielder:IYield<T>) => boolean,\r\n\t\tisEndless?:boolean);\r\n\tconstructor(\r\n\t\tinitializer:() => void,\r\n\t\ttryGetNext:(yielder:IYield<T>) => boolean,\r\n\t\tdisposer?:()=>void,\r\n\t\tisEndless?:boolean);\r\n\tconstructor(\r\n\t\tprivate _initializer:() => void,\r\n\t\tprivate _tryGetNext:(yielder:IYield<T>) => boolean,\r\n\t\tdisposer?:ActionVoid|boolean,\r\n\t\tisEndless?:boolean)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.reset();\r\n\t\tif(Type.isBoolean(isEndless))\r\n\t\t\tthis._isEndless = isEndless;\r\n\t\telse if(Type.isBoolean(disposer))\r\n\t\t\tthis._isEndless = disposer;\r\n\r\n\t\tif(Type.isFunction(disposer))\r\n\t\t\tthis._disposer = disposer;\r\n\t}\r\n\r\n\tprotected _isEndless:boolean;\r\n\t/*\r\n\t * Provides a mechanism to indicate if this enumerable never ends.\r\n\t * If set to true, some operations that expect a finite result may throw.\r\n\t * Explicit false means it has an end.\r\n\t * Implicit void means unknown.\r\n\t */\r\n\tget isEndless():boolean\r\n\t{\r\n\t\treturn this._isEndless;\r\n\t}\r\n\r\n\treset():void\r\n\t{\r\n\t\tvar _ = this;\r\n\t\t_.throwIfDisposed();\r\n\t\tvar y = _._yielder;\r\n\t\t_._yielder = null;\r\n\r\n\t\t_._state = EnumeratorState.Before;\r\n\r\n\t\tif(y) yielder(y); // recycle until actually needed.\r\n\t}\r\n\r\n\tmoveNext():boolean\r\n\t{\r\n\t\tvar _ = this;\r\n\t\ttry\r\n\t\t{\r\n\t\t\tswitch(_._state)\r\n\t\t\t{\r\n\t\t\t\tcase EnumeratorState.Before:\r\n\t\t\t\t\t_._yielder = _._yielder || yielder();\r\n\t\t\t\t\t_._state = EnumeratorState.Running;\r\n\t\t\t\t\tvar initializer = _._initializer;\r\n\t\t\t\t\tif(initializer)\r\n\t\t\t\t\t\tinitializer();\r\n\t\t\t\t// fall through\r\n\t\t\t\tcase EnumeratorState.Running:\r\n\t\t\t\t\tif(_._tryGetNext(_._yielder))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.dispose();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnumeratorState.After:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tthis.dispose();\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t}\r\n\r\n\tnextValue():T\r\n\t{\r\n\t\treturn this.moveNext()\r\n\t\t\t? this.current\r\n\t\t\t: VOID0;\r\n\t}\r\n\r\n\t/**\r\n\t * Exposed for compatibility with generators.\r\n\t */\r\n\tnext():IIteratorResult<T>\r\n\t{\r\n\t\treturn this.moveNext()\r\n\t\t\t? new IteratorResult(this.current, this.index)\r\n\t\t\t: IteratorResult.Done\r\n\t}\r\n\r\n\t'return'():IIteratorResult<void>\r\n\t'return'<TReturn>(value:TReturn):IIteratorResult<TReturn>\r\n\t'return'(value?:any):IIteratorResult<any>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\treturn value===VOID0 || this._state===EnumeratorState.After\r\n\t\t\t\t? IteratorResult.Done\r\n\t\t\t\t: new IteratorResult(value, VOID0, true);\r\n\t\t}\r\n\t\tfinally\r\n\t\t{\r\n\t\t\tthis.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _onDispose():void\r\n\t{\r\n\t\tvar _ = this, disposer = _._disposer;\r\n\r\n\t\t_._initializer = null;\r\n\t\t_._disposer = null;\r\n\r\n\r\n\t\tvar y = _._yielder;\r\n\t\t_._yielder = null;\r\n\t\tthis._state = EnumeratorState.After;\r\n\r\n\t\tif(y) yielder(y);\r\n\r\n\t\tif(disposer)\r\n\t\t\tdisposer();\r\n\t}\r\n\r\n}\r\n\r\nexport default EnumeratorBase;\r\n"]}