/*!
 * @author electricessence / https://github.com/electricessence/
 * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md
 * Based on code from: https://github.com/kriskowal/q
 */
!function(e){if("object"==typeof module&&"object"==typeof module.exports){var n=e(require,exports);void 0!==n&&(module.exports=n)}else"function"==typeof define&&define.amd&&define(["require","exports","../Types","../Collections/LinkedNodeList","../Collections/Queue","../Disposable/ObjectPool"],e)}(function(e,n){"use strict";function t(){for(var e;e=m.first;){var n=e.task,t=e.domain,i=e.context,s=e.args;e.canceller(),t&&t.enter(),o(n,t,i,s)}for(var r;r=g.dequeue();)o(r);p=!1}function o(e,n,o,i){try{e.apply(o,i)}catch(s){if(d)throw n&&n.exit(),setTimeout(t,0),n&&n.enter(),s;setTimeout(function(){throw s},0)}n&&n.exit()}function i(){p||(p=!0,c())}function s(e,n,t){var o=v.take();return o.task=e,o.domain=d&&process.domain,o.context=n,o.args=t&&t.slice(),o.canceller=function(){if(!o)return!1;var e=!!m.removeNode(o);return v.add(o),o=null,e},m.addNode(o),i(),{cancel:o.canceller,dispose:function(){o&&o.canceller()}}}function r(e){g.enqueue(e),i()}var c,u=e("../Types"),l=e("../Collections/LinkedNodeList"),a=e("../Collections/Queue"),f=e("../Disposable/ObjectPool"),d=!1,p=!1,m=new l.LinkedNodeList,g=new a.Queue,v=new f.ObjectPool(40,function(){return{}},function(e){e.task=null,e.domain=null,e.context=null,e.args&&(e.args.length=0),e.args=null,e.canceller=null});if(n.deferImmediate=s,n.runAfterDeferred=r,u.Type.isObject(process)&&"[object process]"===process.toString()&&process.nextTick)d=!0,c=function(){process.nextTick(t)};else if("function"==typeof setImmediate)c="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var y=new MessageChannel;y.port1.onmessage=function(){c=b,y.port1.onmessage=t,t()};var b=function(){y.port2.postMessage(0)};c=function(){setTimeout(t,0),b()}}else c=function(){setTimeout(t,0)};Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=s});
//# sourceMappingURL=deferImmediate.js.map
